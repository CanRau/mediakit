import{ssrElement as w,mergeProps as C,ssr as U,ssrAttribute as m,escape as E}from"solid-js/web";import{createSignal as l,createEffect as y,on as h,onCleanup as L}from"solid-js";const p=e=>typeof e=="function"?e():e,A=(e,t,a)=>{const s=["play","pause","ended"],o=["load","loadeddata"],r=[...s,...o],i=n=>{s.includes(n)?e(n==="play"?!1:n==="pause"?!0:a.ended):t(n==="load")};return r.forEach(n=>a.addEventListener(n,()=>i(n))),()=>{r.forEach(n=>a.removeEventListener(n,()=>i(n)))}},B=(e,t)=>{const a=["click","keydown","mousemove"],s=()=>e(t());return a.forEach(o=>document.addEventListener(o,s)),()=>{a.forEach(o=>document.removeEventListener(o,s))}},F=e=>{const t=A(e.setPaused,e.setIsVideoLoading,e.video),a=B(e.setCanBeUnmuted,e.videoCanUnmute);return()=>{t(),a()}};var P=["<source",">"];const V=()=>typeof navigator>"u"?!1:navigator.userActivation.isActive||navigator.userActivation.hasBeenActive;function x(e){let t={};const[a,s]=l(!0),[o,r]=l(V()),[i,n]=l(!0),v=async()=>{t.muted=!0,await c()},g=u=>(y(h(()=>p(u.autoplay),async d=>{if(d){if(!t.paused)return s(!1);try{await c()}catch{const f=u.onFailed??e.onFailed;f?await f(t,async()=>{try{await c()}catch{await v()}},o()):await v()}}})),y(()=>{const d=F({video:t,videoCanUnmute:V,setCanBeUnmuted:r,setPaused:s,setIsVideoLoading:n});L(d)}),w("video",C(u,{get autoplay(){return p(u.autoplay)}}),()=>U(P,m("src",E(e.source,!0),!1)+m("type",E(e.type,!0),!1)),!0)),c=async()=>{t.ended&&(t.currentTime=0),t.paused&&await t.play()};return{Video:g,play:c,pause:()=>{t.paused||t.pause()},paused:a,canBeUnmuted:o,isVideoLoading:i}}export{x as c};
