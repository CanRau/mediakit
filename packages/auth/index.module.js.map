{"version":3,"file":"index.module.js","sources":["../../src/index.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { Auth } from '@auth/core'\nimport type { Provider } from '@auth/core/providers'\nimport type { AuthAction, AuthConfig, Session } from '@auth/core/types'\n\nexport interface SolidAuthConfig extends Omit<AuthConfig, 'providers'> {\n  prefix?: string\n  providers: Provider<any>[]\n}\n\nconst actions: AuthAction[] = [\n  'providers',\n  'session',\n  'csrf',\n  'signin',\n  'signout',\n  'callback',\n  'verify-request',\n  'error',\n]\n\nfunction SolidAuthHandler(prefix: string, authOptions: SolidAuthConfig) {\n  return async (event: any) => {\n    const { request } = event\n    const url = new URL(request.url)\n    const action = url.pathname\n      .slice(prefix.length + 1)\n      .split('/')[0] as AuthAction\n\n    if (!actions.includes(action) || !url.pathname.startsWith(prefix + '/')) {\n      return\n    }\n\n    return await Auth(request, authOptions)\n  }\n}\n\nexport function SolidAuth(config: SolidAuthConfig) {\n  const { prefix = '/api/auth', ...authOptions } = config\n  authOptions.secret ??= process.env.AUTH_SECRET\n  authOptions.trustHost ??= !!(\n    process.env.AUTH_TRUST_HOST ??\n    process.env.VERCEL ??\n    process.env.NODE_ENV !== 'production'\n  )\n  const handler = SolidAuthHandler(prefix, authOptions)\n  return {\n    async GET(event: any) {\n      return await handler(event)\n    },\n    async POST(event: any) {\n      return await handler(event)\n    },\n  }\n}\n\nexport type GetSessionResult = Promise<Session | null>\n\nexport async function getSession(\n  req: Request,\n  options: AuthConfig,\n  serverResponse?: Response\n): GetSessionResult {\n  options.secret ??= process.env.AUTH_SECRET\n  options.trustHost ??= true\n\n  const url = new URL('/api/auth/session', req.url)\n  const response = await Auth(\n    new Request(url, { headers: req.headers }),\n    options\n  )\n\n  const { status = 200 } = response\n\n  const cookie = response.headers.get('set-cookie')\n  if (cookie && serverResponse) {\n    serverResponse.headers.append('set-cookie', cookie)\n  }\n\n  const data = await response.json()\n\n  if (!data || !Object.keys(data).length) return null\n  if (status === 200) return data\n  throw new Error(data.message)\n}\n"],"names":["actions","SolidAuthHandler","prefix","authOptions","event","request","url","URL","action","pathname","slice","length","split","includes","startsWith","Auth","SolidAuth","config","secret","process","env","AUTH_SECRET","trustHost","AUTH_TRUST_HOST","VERCEL","NODE_ENV","handler","GET","POST","getSession","req","options","serverResponse","response","Request","headers","status","cookie","get","append","data","json","Object","keys","Error","message"],"mappings":"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"}